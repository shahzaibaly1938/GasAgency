{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen bg-[var(--background)] py-8 px-2 md:px-8">
  <div class="max-w-5xl mx-auto">
    <!-- Header and Add Expense Button -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
      <h1 class="text-2xl font-bold text-[var(--primary)] tracking-wide">Expenses</h1>
      <div>
      <a href="{% url 'add_expenses_category' %}" class="inline-block text-[var(--primary)] font-semibold px-6 py-2 rounded-lg shadow transition">
        + Add Expense Category
      </a>
      <a href="{% url 'add_expenses' %}" class="inline-block bg-[var(--primary)] hover:bg-[var(--secondary)] text-[var(--text_secondary)] font-semibold px-6 py-2 rounded-lg shadow transition">
        + Add Expense
      </a></div>
    </div>
    <!-- Filters -->
    <form method="get" class="flex flex-col md:flex-row gap-4 mb-6">
      <input type="text" name="search" value="{{ request.GET.search }}" placeholder="Search by name"
        class="w-full md:w-1/3 px-4 py-2 rounded-lg border border-[var(--box_background)] bg-[var(--box_background)] text-[var(--text_primary)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition">
      <select name="category"
        class="w-full md:w-1/4 px-4 py-2 rounded-lg border border-[var(--box_background)] bg-[var(--box_background)] text-[var(--text_primary)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition">
        <option value="">All Categories</option>
        {% for cat in categories %}
          <option value="{{ cat }}" {% if request.GET.category == cat %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="w-full md:w-auto px-6 py-2 rounded-lg bg-[var(--primary)] text-[var(--text_secondary)] font-semibold hover:bg-[var(--secondary)] transition">Filter</button>
    </form>
    <!-- Expense Table -->
    <div class="bg-[var(--box_background)] rounded-xl shadow p-4 overflow-x-auto">
      <table class="min-w-full text-left">
        <thead>
          <tr class="text-[var(--primary)] font-semibold text-sm border-b border-[var(--primary)]">
            <th class="py-3 px-2">Date</th>
            <th class="py-3 px-2">Name</th>
            <th class="py-3 px-2">Category</th>
            <th class="py-3 px-2">Amount</th>
            <th class="py-3 px-2 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for expense in expenses %}
          <tr class="border-b border-[var(--background)] hover:bg-[var(--background)] transition">
            <td class="py-2 px-2">{{ expense.date|date:"Y-m-d" }}</td>
            <td class="py-2 px-2">{{ expense.name }}</td>
            <td class="py-2 px-2">{{ expense.category }}</td>
            <td class="py-2 px-2 font-semibold text-[var(--primary)]">Rs. {{ expense.amount }}</td>
            <td class="py-2 px-2 flex gap-2 justify-center">
              <a href="{% url 'expense_detail' expense.id %}" class="text-[var(--primary)] hover:underline font-semibold">View</a>
              <a href="{% url 'edit_expenses' expense.id %}" class="text-[var(--secondary)] hover:underline font-semibold">Edit</a>
              <form method="post" action="{% url 'delete_expense' expense.id %}" class="inline">
                {% csrf_token %}
                <button type="submit" onclick="return confirm('Are you sure you want to delete this expense?')" class="text-red-600 hover:underline font-semibold bg-transparent border-none p-0 m-0">Delete</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-[var(--primary)] py-8">No expenses found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- Pagination -->
    {% if expenses.has_other_pages %}
    <div class="flex justify-center mt-6">
      <nav class="inline-flex rounded-md shadow-sm" aria-label="Pagination">
        {% if expenses.has_previous %}
          <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}page={{ expenses.previous_page_number }}"
            class="px-3 py-1 rounded-l-lg bg-white border border-[var(--primary)] text-[var(--primary)] hover:bg-[var(--primary)] hover:text-white transition">Previous</a>
        {% else %}
          <span class="px-3 py-1 rounded-l-lg bg-gray-200 border border-[var(--primary)] text-gray-400 cursor-not-allowed">Previous</span>
        {% endif %}
        {% for num in expenses.paginator.page_range %}
          {% if expenses.number == num %}
            <span class="px-3 py-1 bg-[var(--primary)] text-white border border-[var(--primary)]">{{ num }}</span>
          {% elif num > expenses.number|add:'-3' and num < expenses.number|add:'3' %}
            <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}page={{ num }}"
              class="px-3 py-1 bg-white border border-[var(--primary)] text-[var(--primary)] hover:bg-[var(--primary)] hover:text-white transition">{{ num }}</a>
          {% endif %}
        {% endfor %}
        {% if expenses.has_next %}
          <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.category %}category={{ request.GET.category }}&{% endif %}page={{ expenses.next_page_number }}"
            class="px-3 py-1 rounded-r-lg bg-white border border-[var(--primary)] text-[var(--primary)] hover:bg-[var(--primary)] hover:text-white transition">Next</a>
        {% else %}
          <span class="px-3 py-1 rounded-r-lg bg-gray-200 border border-[var(--primary)] text-gray-400 cursor-not-allowed">Next</span>
        {% endif %}
      </nav>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}